# DocAI Platform

AI é©±åŠ¨çš„ä¼ä¸šçº§æ–‡æ¡£ç®¡ç†ç³»ç»Ÿ â€”â€” æ”¯æŒç²¾ç¡®æ£€ç´¢ã€è·¨æ–‡æ¡£æ€»ç»“ã€å¤šç‰ˆæœ¬å¯¹æ¯”ã€æ™ºèƒ½ Agent åˆ†æã€‚

## âœ¨ æ ¸å¿ƒåŠŸèƒ½

- **ğŸ“„ å¤šæ ¼å¼æ–‡æ¡£è§£æ** â€” PDF / Word / PPT / Excel / CSV / TXT / MDï¼Œä¿ç•™æ ‡é¢˜å±‚çº§ã€é¡µç ã€è¡¨æ ¼ç»“æ„
- **ğŸ” æ··åˆæ£€ç´¢ (RAG)** â€” å‘é‡æ£€ç´¢ (Qdrant) + BM25 å…³é”®è¯æ£€ç´¢ (Elasticsearch) + RRF èåˆ + BGE Reranker é‡æ’
- **ğŸ“ é¢„å»ºå¤šçº§æ‘˜è¦** â€” ç« èŠ‚çº§ + æ–‡æ¡£çº§æ‘˜è¦ç¦»çº¿ç”Ÿæˆï¼ŒContextual Retrieval å¢å¼ºæ£€ç´¢ç²¾åº¦
- **ğŸ“Š è·¨æ–‡æ¡£æ€»ç»“** â€” Map-Reduce æ¨¡å¼ï¼Œæ”¯æŒè·¨æ–‡æ¡£åˆ†æå’Œç»¼åˆæ¯”è¾ƒ
- **ğŸ”„ å¤šç‰ˆæœ¬ç®¡ç†** â€” è‡ªåŠ¨ç‰ˆæœ¬æ£€æµ‹ï¼ˆæ ‡é¢˜ + å†…å®¹ + LLM ç¡®è®¤ï¼‰ã€ä¸‰å±‚å·®å¼‚å¯¹æ¯”ï¼ˆæ–‡æœ¬ + ç»“æ„ + è¯­ä¹‰ï¼‰
- **ğŸ¤– æ™ºèƒ½ Agent** â€” ReAct é£æ ¼å¤šæ­¥æ¨ç†ï¼Œè‡ªä¸»é€‰æ‹©å·¥å…·å®Œæˆå¤æ‚åˆ†æä»»åŠ¡
- **ğŸ›¡ï¸ å®‰å…¨æƒé™** â€” JWT è®¤è¯ã€RBAC è§’è‰²æƒé™ã€æ–‡æ¡£çº§è®¿é—®æ§åˆ¶ã€å®¡è®¡æ—¥å¿—
- **ğŸ’¬ æµå¼é—®ç­”** â€” SSE å®æ—¶è¾“å‡ºï¼ŒAgent æ¨ç†è¿‡ç¨‹å¯è§†åŒ–

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              åº”ç”¨å±‚ (Application)                     â”‚
â”‚   ç²¾ç¡®æ£€ç´¢ Â· è·¨æ–‡æ¡£æ€»ç»“ Â· ç‰ˆæœ¬å¯¹æ¯” Â· é—®ç­”äº¤äº’          â”‚
â”‚   Next.js å‰ç«¯ Â· FastAPI åç«¯                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              ç¼–æ’å±‚ (Orchestration)                   â”‚
â”‚   Query Router Â· Document Agent (ReAct) Â· å·¥å…·é›†      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ£€ç´¢å±‚    â”‚ æ‘˜è¦å±‚   â”‚ ç‰ˆæœ¬ç®¡ç†å±‚â”‚   å®‰å…¨å±‚            â”‚
â”‚ æ··åˆ RAG  â”‚ Summary  â”‚ Version  â”‚   Auth & RBAC      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              å­˜å‚¨ä¸ç´¢å¼•å±‚ (Storage & Index)            â”‚
â”‚   Qdrant Â· Elasticsearch Â· MinIO Â· PostgreSQL Â· Redisâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              æ–‡æ¡£å¤„ç†å±‚ (Document Processing)          â”‚
â”‚   è§£æ Â· åˆ†å— Â· åµŒå…¥ Â· æ‘˜è¦ç”Ÿæˆ Â· å®ä½“æå– Â· ç‰ˆæœ¬æ ‡è®°  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

- Docker & Docker Compose
- Python 3.11+
- Node.js 18+ (å‰ç«¯)
- GPUï¼ˆæ¨èï¼Œç”¨äº BGE-M3 åµŒå…¥æ¨¡å‹å’Œ BGE Rerankerï¼›æ—  GPU å¯æ”¹ç”¨ CPU æ¨¡å¼ï¼‰
- LLM API Keyï¼ˆAnthropic Claude æˆ– OpenAIï¼‰

### ä¸€é”®å¯åŠ¨

```bash
# 1. å…‹éš†é¡¹ç›®
git clone https://github.com/shaopengxu/docai-platform.git && cd docai-platform

# 2. é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘ .envï¼Œå¡«å…¥ä½ çš„ ANTHROPIC_API_KEYï¼ˆå¿…é¡»ï¼‰

# 3. å®Œæ•´å®‰è£…ï¼ˆåˆ›å»ºè™šæ‹Ÿç¯å¢ƒ â†’ å®‰è£…ä¾èµ– â†’ å¯åŠ¨æœåŠ¡ â†’ åˆå§‹åŒ– â†’ éªŒè¯ï¼‰
make setup

# 4. å¯åŠ¨åç«¯ + å‰ç«¯ï¼ˆåˆ†åˆ«åœ¨ä¸¤ä¸ªç»ˆç«¯ä¸­æ‰§è¡Œï¼‰
make dev       # ç»ˆç«¯ 1: åç«¯ API  http://localhost:8000
make web-dev   # ç»ˆç«¯ 2: å‰ç«¯ UI   http://localhost:3000
```

### æ‰‹åŠ¨æ­¥éª¤

```bash
# åˆ›å»ºå¹¶æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
python -m venv .venv
source .venv/bin/activate

# å®‰è£… Python ä¾èµ–
pip install -e ".[dev]"

# å¯åŠ¨åŸºç¡€æœåŠ¡
docker-compose up -d

# ç­‰å¾…æœåŠ¡å°±ç»ªååˆå§‹åŒ–ç´¢å¼•ï¼ˆQdrant collection + ES index + PG tablesï¼‰
python -m scripts.init_infrastructure

# éªŒè¯æ‰€æœ‰æœåŠ¡
python -m scripts.verify_services

# å¯åŠ¨å‰ç«¯
cd web && npm install && npm run dev
```

## é¡¹ç›®ç»“æ„

```
docai-platform/
â”œâ”€â”€ app/                          # åç«¯åº”ç”¨ä»£ç 
â”‚   â”œâ”€â”€ api/                      #   API è·¯ç”± (FastAPI)
â”‚   â”‚   â”œâ”€â”€ documents.py          #     æ–‡æ¡£ä¸Šä¼ ã€åˆ—è¡¨ã€åˆ é™¤
â”‚   â”‚   â”œâ”€â”€ query.py              #     é—®ç­”ï¼ˆæ™ºèƒ½è·¯ç”±: simple_rag / enhanced_rag / agentï¼‰
â”‚   â”‚   â”œâ”€â”€ versions.py           #     ç‰ˆæœ¬å†å²ã€å·®å¼‚å¯¹æ¯”ã€æ‰‹åŠ¨å…³è”
â”‚   â”‚   â””â”€â”€ auth.py               #     ç™»å½•ã€æ³¨å†Œã€ç”¨æˆ·/æƒé™ç®¡ç†ã€å®¡è®¡æ—¥å¿—
â”‚   â”œâ”€â”€ core/                     #   æ ¸å¿ƒæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ infrastructure.py     #     æ•°æ®åº“/ç¼“å­˜è¿æ¥ç®¡ç† (å•ä¾‹æ¨¡å¼)
â”‚   â”‚   â”œâ”€â”€ llm_client.py         #     LLM è°ƒç”¨æŠ½è±¡å±‚ (Claude / GPT)
â”‚   â”‚   â”œâ”€â”€ embedding.py          #     BGE-M3 åµŒå…¥æ¨¡å‹ç®¡ç†
â”‚   â”‚   â””â”€â”€ models.py             #     Pydantic æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ ingestion/                #   æ–‡æ¡£å¤„ç†å±‚
â”‚   â”‚   â”œâ”€â”€ pipeline.py           #     å…¥åº“å®Œæ•´ Pipeline (936 è¡Œæ ¸å¿ƒé€»è¾‘)
â”‚   â”‚   â”œâ”€â”€ parser.py             #     å¤šæ ¼å¼è§£æ (PDF/Word/PPT/Excel/CSV/TXT/MD)
â”‚   â”‚   â”œâ”€â”€ chunker.py            #     è¯­ä¹‰åˆ†å— (ç« èŠ‚/æ®µè½è¾¹ç•Œåˆ‡åˆ†)
â”‚   â”‚   â””â”€â”€ summarizer.py         #     LLM æ‘˜è¦ç”Ÿæˆ + å®ä½“æå–
â”‚   â”œâ”€â”€ retrieval/                #   æ£€ç´¢å±‚
â”‚   â”‚   â”œâ”€â”€ hybrid_search.py      #     æ··åˆæ£€ç´¢ (å‘é‡+BM25+RRF+Reranker+ä¸Šä¸‹æ–‡æ‰©å±•)
â”‚   â”‚   â””â”€â”€ router.py             #     æ™ºèƒ½è·¯ç”± (LLM æ„å›¾åˆ†æ)
â”‚   â”œâ”€â”€ generation/               #   ç”Ÿæˆå±‚
â”‚   â”‚   â””â”€â”€ answer.py             #     ç­”æ¡ˆç”Ÿæˆ + Map-Reduce è·¨æ–‡æ¡£æ€»ç»“
â”‚   â”œâ”€â”€ agent/                    #   Agent å±‚
â”‚   â”‚   â”œâ”€â”€ agent.py              #     ReAct Agent (Thoughtâ†’Actionâ†’Observation å¾ªç¯)
â”‚   â”‚   â””â”€â”€ tools.py              #     7 ä¸ªå·¥å…· (æ£€ç´¢/æ‘˜è¦/å¯¹æ¯”/ç‰ˆæœ¬/åˆ†æ)
â”‚   â”œâ”€â”€ versioning/               #   ç‰ˆæœ¬ç®¡ç†å±‚
â”‚   â”‚   â”œâ”€â”€ detector.py           #     ç‰ˆæœ¬è‡ªåŠ¨è¯†åˆ« (æ ‡é¢˜+å†…å®¹+LLM ä¸‰çº§æ£€æµ‹)
â”‚   â”‚   â””â”€â”€ diff_engine.py        #     ä¸‰å±‚å·®å¼‚å¯¹æ¯” (æ–‡æœ¬+ç»“æ„+è¯­ä¹‰)
â”‚   â”œâ”€â”€ auth/                     #   å®‰å…¨è®¤è¯å±‚
â”‚   â”‚   â”œâ”€â”€ jwt.py                #     JWT Token ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ models.py             #     ç”¨æˆ·/è§’è‰²/æƒé™æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ permissions.py        #     RBAC æƒé™æ£€æŸ¥
â”‚   â”‚   â”œâ”€â”€ dependencies.py       #     FastAPI ä¾èµ–æ³¨å…¥
â”‚   â”‚   â”œâ”€â”€ audit.py              #     å®¡è®¡æ—¥å¿—
â”‚   â”‚   â””â”€â”€ password.py           #     å¯†ç å“ˆå¸Œ
â”‚   â””â”€â”€ main.py                   #   FastAPI åº”ç”¨å…¥å£
â”œâ”€â”€ web/                          # å‰ç«¯åº”ç”¨ (Next.js + TypeScript)
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ app/                  #   é¡µé¢ (é—®ç­”/ä¸Šä¼ /æ–‡æ¡£ç®¡ç†/ç‰ˆæœ¬å¯¹æ¯”)
â”‚       â”œâ”€â”€ components/           #   é€šç”¨ç»„ä»¶
â”‚       â”œâ”€â”€ services/             #   API å®¢æˆ·ç«¯ (SSE æµå¼æ”¯æŒ)
â”‚       â””â”€â”€ types/                #   TypeScript ç±»å‹å®šä¹‰
â”œâ”€â”€ config/
â”‚   â””â”€â”€ settings.py               # é…ç½®ç®¡ç† (Pydantic Settings, 60+ é…ç½®é¡¹)
â”œâ”€â”€ docker/
â”‚   â”œâ”€â”€ elasticsearch/            # ES + IK ä¸­æ–‡åˆ†è¯ Dockerfile
â”‚   â””â”€â”€ postgres/                 # PG åˆå§‹åŒ– SQL + æƒé™è¡¨ SQL
â”œâ”€â”€ scripts/                      # è¿ç»´è„šæœ¬
â”‚   â”œâ”€â”€ init_infrastructure.py    #   åŸºç¡€è®¾æ–½åˆå§‹åŒ– (Qdrant/ES/PG/MinIO)
â”‚   â”œâ”€â”€ verify_services.py        #   æœåŠ¡å¥åº·æ£€æŸ¥
â”‚   â””â”€â”€ validate_phase1.py        #   Phase 1 ç«¯åˆ°ç«¯éªŒè¯
â”œâ”€â”€ tests/                        # æµ‹è¯•
â”œâ”€â”€ docker-compose.yml            # å¼€å‘ç¯å¢ƒä¸€é”®å¯åŠ¨ï¼ˆ6 ä¸ªæœåŠ¡ï¼‰
â”œâ”€â”€ pyproject.toml                # Python é¡¹ç›®é…ç½® & ä¾èµ–
â”œâ”€â”€ Makefile                      # å¸¸ç”¨å‘½ä»¤å¿«æ·æ–¹å¼
â””â”€â”€ .env                          # ç¯å¢ƒå˜é‡ï¼ˆä¸æäº¤ gitï¼‰
```

## åŸºç¡€æœåŠ¡

| æœåŠ¡          | åœ°å€                            | ç”¨é€”                                  |
| ------------- | ------------------------------- | ------------------------------------- |
| åç«¯ API      | http://localhost:8000           | FastAPI åç«¯                          |
| API æ–‡æ¡£      | http://localhost:8000/docs      | Swagger äº¤äº’å¼æ–‡æ¡£                    |
| å‰ç«¯          | http://localhost:3000           | Next.js å‰ç«¯ç•Œé¢                      |
| Qdrant        | http://localhost:6333/dashboard | å‘é‡æ•°æ®åº“ç®¡ç†                        |
| Elasticsearch | http://localhost:9200           | å…¨æ–‡æœç´¢å¼•æ“                          |
| MinIO         | http://localhost:9001           | å¯¹è±¡å­˜å‚¨ç®¡ç† (admin / minio_dev_2025) |
| PostgreSQL    | localhost:5432                  | å…ƒæ•°æ®åº“ (docai / docai_dev_2025)     |
| Redis         | localhost:6379                  | ç¼“å­˜                                  |

## å¸¸ç”¨å‘½ä»¤

```bash
make help       # æŸ¥çœ‹æ‰€æœ‰å‘½ä»¤
make up         # å¯åŠ¨åŸºç¡€æœåŠ¡ (Docker: PG/Qdrant/ES/MinIO/Redis)
make down       # åœæ­¢åŸºç¡€æœåŠ¡
make dev        # å¯åŠ¨åç«¯å¼€å‘æœåŠ¡å™¨ (localhost:8000)
make web-dev    # å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨ (localhost:3000)
make verify     # éªŒè¯æœåŠ¡çŠ¶æ€
make test       # è¿è¡Œæµ‹è¯•
make logs       # æŸ¥çœ‹æœåŠ¡æ—¥å¿—
make clean      # æ¸…ç†æ‰€æœ‰æ•°æ®ï¼ˆâš ï¸ ä¸å¯é€†ï¼‰
```

## API ç«¯ç‚¹

### æ–‡æ¡£ç®¡ç†

| æ–¹æ³•   | è·¯å¾„                                  | è¯´æ˜                                           |
| ------ | ------------------------------------- | ---------------------------------------------- |
| POST   | `/api/v1/documents`                   | ä¸Šä¼ æ–‡æ¡£ï¼ˆæ”¯æŒ PDF/Word/PPT/Excel/CSV/TXT/MDï¼‰ |
| GET    | `/api/v1/documents`                   | æ–‡æ¡£åˆ—è¡¨ï¼ˆæ”¯æŒæŒ‰ç±»å‹ã€çŠ¶æ€è¿‡æ»¤ã€åˆ†é¡µï¼‰         |
| GET    | `/api/v1/documents/{doc_id}`          | æ–‡æ¡£è¯¦æƒ…ï¼ˆå«å¤„ç†çŠ¶æ€ã€ç‰ˆæœ¬ä¿¡æ¯ï¼‰               |
| PUT    | `/api/v1/documents/{doc_id}/metadata` | æ›´æ–°æ–‡æ¡£å…ƒæ•°æ®ï¼ˆåˆ†ç»„ã€æ ‡ç­¾ã€éƒ¨é—¨ï¼‰             |
| DELETE | `/api/v1/documents/{doc_id}`          | åˆ é™¤æ–‡æ¡£åŠå…¨éƒ¨å…³è”æ•°æ®                         |
| GET    | `/api/v1/documents/{doc_id}/chunks`   | æŸ¥çœ‹æ–‡æ¡£åˆ†å—ï¼ˆè°ƒè¯•ç”¨ï¼‰                         |
| POST   | `/api/v1/documents/groups`            | åˆ›å»ºæ–‡æ¡£ç»„                                     |
| GET    | `/api/v1/documents/groups`            | è·å–æ–‡æ¡£ç»„åˆ—è¡¨                                 |

### æ™ºèƒ½é—®ç­”

| æ–¹æ³• | è·¯å¾„                   | è¯´æ˜                                                    |
| ---- | ---------------------- | ------------------------------------------------------- |
| POST | `/api/v1/query`        | æ–‡æ¡£é—®ç­”ï¼ˆè‡ªåŠ¨è·¯ç”±: simple_rag / enhanced_rag / agentï¼‰ |
| POST | `/api/v1/query/stream` | æµå¼é—®ç­”ï¼ˆSSE, æ”¯æŒ Agent æ¨ç†è¿‡ç¨‹å¯è§†åŒ–ï¼‰              |

### ç‰ˆæœ¬ç®¡ç†

| æ–¹æ³• | è·¯å¾„                                        | è¯´æ˜                                      |
| ---- | ------------------------------------------- | ----------------------------------------- |
| GET  | `/api/v1/versions/{doc_id}/history`         | è·å–æ–‡æ¡£ç‰ˆæœ¬å†å²é“¾                        |
| GET  | `/api/v1/versions/{doc_id}/diff/{other_id}` | ä¸¤ä¸ªç‰ˆæœ¬çš„ä¸‰å±‚å·®å¼‚å¯¹æ¯”                    |
| PUT  | `/api/v1/versions/{doc_id}/link`            | æ‰‹åŠ¨å…³è”ç‰ˆæœ¬                              |
| PUT  | `/api/v1/versions/{doc_id}/status`          | æ›´æ–°ç‰ˆæœ¬çŠ¶æ€ (active/superseded/archived) |

### è®¤è¯ä¸æƒé™

| æ–¹æ³• | è·¯å¾„                           | è¯´æ˜                       |
| ---- | ------------------------------ | -------------------------- |
| POST | `/api/v1/auth/login`           | ç”¨æˆ·ç™»å½•ï¼ˆè¿”å› JWT Tokenï¼‰ |
| POST | `/api/v1/auth/register`        | ç”¨æˆ·æ³¨å†Œ                   |
| GET  | `/api/v1/auth/me`              | è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯           |
| GET  | `/api/v1/auth/users`           | ç”¨æˆ·åˆ—è¡¨ï¼ˆç®¡ç†å‘˜ï¼‰         |
| PUT  | `/api/v1/auth/users/{user_id}` | æ›´æ–°ç”¨æˆ·ä¿¡æ¯ï¼ˆç®¡ç†å‘˜ï¼‰     |
| POST | `/api/v1/auth/permissions`     | æˆäºˆæ–‡æ¡£æƒé™ï¼ˆç®¡ç†å‘˜ï¼‰     |
| GET  | `/api/v1/auth/audit-logs`      | æŸ¥è¯¢å®¡è®¡æ—¥å¿—ï¼ˆç®¡ç†å‘˜ï¼‰     |

## ä½¿ç”¨ç¤ºä¾‹

```bash
# 1. ä¸Šä¼ æ–‡æ¡£
curl -X POST http://localhost:8000/api/v1/documents \
  -F "file=@my_contract.pdf" \
  -F "doc_type=contract" \
  -F "tags=ä¾›åº”å•†,2025å¹´"

# è¿”å›: {"doc_id": "xxx", "processing_status": "pending", ...}
# åå°å¼‚æ­¥å¤„ç†: è§£æ â†’ åˆ†å— â†’ æ‘˜è¦ â†’ åµŒå…¥ â†’ å­˜å‚¨ (çº¦ 20-80 ç§’)

# 2. æŸ¥è¯¢å¤„ç†çŠ¶æ€ï¼ˆç­‰å¾… status å˜ä¸º "ready"ï¼‰
curl http://localhost:8000/api/v1/documents/{doc_id}

# 3. ç®€å•é—®ç­”
curl -X POST http://localhost:8000/api/v1/query \
  -H "Content-Type: application/json" \
  -d '{"question": "ä»˜æ¬¾å‘¨æœŸæ˜¯å¤šå°‘å¤©ï¼Ÿ", "doc_id": "xxx"}'

# è¿”å›: {"answer": "...", "citations": [...], "confidence": 0.85, "latency_ms": 2300}

# 4. æµå¼é—®ç­”ï¼ˆSSE, æ”¯æŒ Agent æ¨ç†å¯è§†åŒ–ï¼‰
curl -X POST http://localhost:8000/api/v1/query/stream \
  -H "Content-Type: application/json" \
  -d '{"question": "å¯¹æ¯”æ‰€æœ‰åˆåŒä¸­çš„ä»˜æ¬¾æ¡æ¬¾ï¼Œæ‰¾å‡ºå·®å¼‚"}'

# 5. ç‰ˆæœ¬å·®å¼‚å¯¹æ¯”
curl http://localhost:8000/api/v1/versions/{doc_id}/diff/{other_doc_id}
```

## æ ¸å¿ƒå¤„ç†æµç¨‹

### æ–‡æ¡£å…¥åº“

```
æ–‡æ¡£ä¸Šä¼ 
  â†’ API éªŒè¯(æ ¼å¼/å¤§å°) â†’ ç«‹å³è¿”å› doc_id
  â†’ åå°å¼‚æ­¥: SHA-256 æŒ‡çº¹å»é‡ â†’ MinIO å­˜å‚¨åŸæ–‡
    â†’ è§£æ(PDF/Word/PPT/Excel) â†’ ä¿ç•™æ ‡é¢˜å±‚çº§/é¡µç /è¡¨æ ¼
    â†’ è¯­ä¹‰åˆ†å—(500 tokens, æŒ‰ç« èŠ‚/æ®µè½è¾¹ç•Œ)
    â†’ LLM æ‘˜è¦ç”Ÿæˆ(ç« èŠ‚æ‘˜è¦ + æ–‡æ¡£æ‘˜è¦ + å®ä½“æå–)
    â†’ ç‰ˆæœ¬æ£€æµ‹(æ ‡é¢˜ç›¸ä¼¼ + å†…å®¹ç›¸ä¼¼ + LLM ç¡®è®¤)
    â†’ Contextual Retrieval ä¸Šä¸‹æ–‡å¢å¼º
    â†’ BGE-M3 åµŒå…¥(1024 ç»´) â†’ ä¸‰è·¯å­˜å‚¨(Qdrant + ES + PG)
```

### æ™ºèƒ½é—®ç­”

```
ç”¨æˆ·æé—®
  â†’ æƒé™æ£€æŸ¥(JWT + RBAC)
  â†’ Query Router(LLM åˆ†ææ„å›¾)
    â”œâ”€ simple_rag: æ··åˆæ£€ç´¢(å‘é‡+BM25) â†’ RRF â†’ Reranker â†’ LLM ç”Ÿæˆç­”æ¡ˆ
    â”œâ”€ enhanced_rag: æ··åˆæ£€ç´¢ â†’ Map-Reduce è·¨æ–‡æ¡£æ€»ç»“
    â””â”€ agent: ReAct å¤šæ­¥æ¨ç†(æœ€å¤š 8 æ­¥, 7 ä¸ªå·¥å…·)
  â†’ æµå¼è¿”å›(ç­”æ¡ˆ + å¼•ç”¨æ¥æº + ç½®ä¿¡åº¦)
```

## æŠ€æœ¯æ ˆ

| å±‚çº§           | æŠ€æœ¯                                              |
| -------------- | ------------------------------------------------- |
| **å‰ç«¯**       | Next.js 15 + TypeScript + Tailwind CSS            |
| **åç«¯**       | FastAPI + Python 3.11 + asyncio                   |
| **LLM**        | Claude Sonnet (ä¸»åŠ›æ¨ç†), Claude Haiku (è½»é‡ä»»åŠ¡) |
| **åµŒå…¥æ¨¡å‹**   | BAAI/bge-m3 (1024 ç»´, å¤šè¯­è¨€)                     |
| **Reranker**   | BAAI/bge-reranker-v2-m3                           |
| **å‘é‡æ•°æ®åº“** | Qdrant                                            |
| **å…¨æ–‡æœç´¢**   | Elasticsearch + IK ä¸­æ–‡åˆ†è¯                       |
| **å…ƒæ•°æ®åº“**   | PostgreSQL (asyncpg + SQLAlchemy)                 |
| **å¯¹è±¡å­˜å‚¨**   | MinIO                                             |
| **ç¼“å­˜**       | Redis                                             |
| **å®¹å™¨åŒ–**     | Docker Compose                                    |

## ç¯å¢ƒå˜é‡

åœ¨ `.env` æ–‡ä»¶ä¸­é…ç½®ä»¥ä¸‹å…³é”®å‚æ•°ï¼š

```bash
# å¿…é¡»é…ç½®
ANTHROPIC_API_KEY=sk-ant-xxxxx         # Anthropic API Key

# å¯é€‰é…ç½®
LLM_PROVIDER=anthropic                  # LLM æä¾›å•† (anthropic / openai)
EMBEDDING_DEVICE=cuda                   # åµŒå…¥æ¨¡å‹è®¾å¤‡ (cuda / cpu / mps)
AUTH_ENABLED=false                      # æ˜¯å¦å¯ç”¨è®¤è¯ (æ¸è¿›å¼å¼€å…³)

# åŸºç¡€æœåŠ¡ï¼ˆé»˜è®¤å€¼é€šå¸¸ä¸éœ€è¦ä¿®æ”¹ï¼‰
PG_HOST=localhost
QDRANT_HOST=localhost
ES_HOST=http://localhost:9200
MINIO_ENDPOINT=localhost:9000
REDIS_URL=redis://localhost:6379/0
```

å®Œæ•´é…ç½®é¡¹è¯·å‚è€ƒ [config/settings.py](config/settings.py)ï¼ˆ60+ é…ç½®é¡¹ï¼‰ã€‚

## å¼€å‘è·¯çº¿å›¾

- [x] **Phase 0**: åŸºç¡€è®¾æ–½ & æŠ€æœ¯é€‰å‹
- [x] **Phase 1**: å•æ–‡æ¡£æ£€ç´¢é—®ç­” (MVP) â€” æ–‡æ¡£è§£æã€è¯­ä¹‰åˆ†å—ã€æ··åˆæ£€ç´¢ã€RAG ç­”æ¡ˆç”Ÿæˆ
- [x] **Phase 1 (Frontend)**: Next.js å‰ç«¯ç•Œé¢ â€” ä¸Šä¼ ã€ç®¡ç†ã€æµå¼é—®ç­”
- [x] **Phase 2**: è·¨æ–‡æ¡£æ€»ç»“ â€” æ–‡æ¡£ç»„ã€Map-Reduce æ€»ç»“ã€é¢„å»ºæ‘˜è¦å±‚
- [x] **Phase 3**: ç‰ˆæœ¬ç®¡ç† â€” è‡ªåŠ¨ç‰ˆæœ¬æ£€æµ‹ã€ä¸‰å±‚å·®å¼‚å¯¹æ¯”ã€ç‰ˆæœ¬é“¾è¿½æº¯
- [x] **Phase 4**: æ™ºèƒ½ç¼–æ’ & Agent â€” Query Router ä¸‰é€šé“è·¯ç”±ã€ReAct Agentã€7 ä¸ªå·¥å…·
- [x] **Phase 5**: å®‰å…¨åŠ å›º â€” JWT è®¤è¯ã€RBAC æƒé™ã€æ–‡æ¡£çº§è®¿é—®æ§åˆ¶ã€å®¡è®¡æ—¥å¿—
- [ ] **Phase 6**: çŸ¥è¯†å›¾è°± â€” Neo4j å®ä½“å…³ç³»ã€Graph RAG
- [ ] **Phase 7**: ç”Ÿäº§åŒ– â€” æ€§èƒ½ä¼˜åŒ–ã€ç›‘æ§å‘Šè­¦ã€æ°´å¹³æ‰©å±•

## è®¸å¯è¯

MIT
